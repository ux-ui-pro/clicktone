{"mappings":"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","sources":["src/ClickTone.js"],"sourcesContent":["/**\n * @typedef {Object} window\n * @property {typeof AudioContext} webkitAudioContext\n */\n\nclass ClickTone {\n  #file;\n\n  #volume;\n\n  #callback;\n\n  #throttle;\n\n  #debug;\n\n  #lastClickTime;\n\n  #audioCache;\n\n  #audioContext;\n\n  constructor({\n    file,\n    volume = 1.0,\n    callback = null,\n    throttle = 0,\n    debug = false,\n  }) {\n    this.#file = file;\n    this.#volume = volume;\n    this.#callback = callback;\n    this.#throttle = throttle;\n    this.#debug = debug;\n    this.#lastClickTime = 0;\n    this.#audioCache = {};\n  }\n\n  #initAudioContext() {\n    if (!this.#audioContext) {\n      this.#audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      this.#iOSFixAudioContext();\n    }\n  }\n\n  #iOSFixAudioContext = () => {\n    if (this.#audioContext && this.#audioContext.state === 'suspended' && 'ontouchstart' in window) {\n      const unlock = () => {\n        if (this.#audioContext.state === 'suspended') {\n          this.#audioContext.resume().then(() => {\n            document.body.removeEventListener('touchstart', unlock);\n            document.body.removeEventListener('touchend', unlock);\n          });\n        }\n      };\n\n      document.body.addEventListener('touchstart', unlock, false);\n      document.body.addEventListener('touchend', unlock, false);\n    }\n  };\n\n  #fetchAndDecodeAudio = async (url) => {\n    try {\n      if (this.#audioCache[url]) {\n        return this.#audioCache[url];\n      }\n\n      const response = await fetch(url);\n      const buffer = await response.arrayBuffer();\n      const audioData = await this.#audioContext.decodeAudioData(buffer);\n\n      this.#audioCache[url] = audioData;\n\n      return audioData;\n    } catch (error) {\n      if (this.#debug) {\n        console.error('Audio loading and decoding error: ', error);\n      }\n\n      throw new Error(`Something went wrong when loading and decoding the audio: ${error.message}`);\n    }\n  };\n\n  #audio = async (url) => {\n    this.#initAudioContext();\n\n    try {\n      const audioData = await this.#fetchAndDecodeAudio(url);\n      const source = this.#audioContext.createBufferSource();\n      const gainNode = this.#audioContext.createGain();\n\n      source.buffer = audioData;\n      gainNode.gain.value = this.#volume;\n      source.connect(gainNode);\n      gainNode.connect(this.#audioContext.destination);\n\n      source.onended = () => {\n        if (this.#callback) {\n          this.#callback?.();\n        }\n      };\n\n      source.start(0);\n    } catch (error) {\n      if (this.#debug) {\n        console.error('Audio playback error: ', error);\n      }\n\n      throw new Error(`Something went wrong while playing audio: ${error.message}`);\n    }\n  };\n\n  #throttleFn = (func) => () => {\n    const now = Date.now();\n\n    if (now - this.#lastClickTime >= this.#throttle) {\n      func();\n\n      this.#lastClickTime = now;\n    }\n  };\n\n  play = async (url = this.#file) => {\n    const throttledPlay = this.#throttleFn(() => this.#audio(url));\n\n    try {\n      await throttledPlay();\n    } catch (error) {\n      if (this.#debug) {\n        console.error('Audio playback error: ', error);\n      }\n\n      if (this.#callback) {\n        this.#callback?.(error);\n      } else {\n        throw error;\n      }\n    }\n  };\n}\n\nexport default ClickTone;\n"],"names":[],"version":3,"file":"index.module.js.map"}