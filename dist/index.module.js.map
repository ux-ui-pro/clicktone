{"mappings":"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","sources":["src/index.ts"],"sourcesContent":["declare global {\n  interface Window {\n    webkitAudioContext?: typeof AudioContext;\n  }\n}\n\nclass ClickTone {\n  private readonly file: string;\n  private readonly volume: number;\n  private readonly callback: ((error?: Error) => void) | null;\n  private readonly throttle: number;\n  private readonly debug: boolean;\n  private lastClickTime: number;\n  private readonly audioCache: Record<string, AudioBuffer>;\n  private audioContext: AudioContext | null;\n\n  constructor({\n    file,\n    volume = 1.0,\n    callback = null,\n    throttle = 0,\n    debug = false,\n  }: {\n    file: string;\n    volume?: number;\n    callback?: ((error?: Error) => void) | null;\n    throttle?: number;\n    debug?: boolean;\n  }) {\n    this.file = file;\n    this.volume = volume;\n    this.callback = callback;\n    this.throttle = throttle;\n    this.debug = debug;\n    this.lastClickTime = 0;\n    this.audioCache = {};\n    this.audioContext = null;\n  }\n\n  private initAudioContext(): void {\n    if (!this.audioContext) {\n      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      this.iOSFixAudioContext();\n    }\n  }\n\n  private iOSFixAudioContext(): void {\n    if (this.audioContext && this.audioContext.state === 'suspended' && 'ontouchstart' in window) {\n      const unlock = (): void => {\n        if (this.audioContext!.state === 'suspended') {\n          void this.audioContext!.resume()\n            .then(() => {\n              document.body.removeEventListener('touchstart', unlock);\n              document.body.removeEventListener('touchend', unlock);\n            })\n            .catch((error) => {\n              if (this.debug) {\n                console.error('AudioContext resume error:', error);\n              }\n            });\n        }\n      };\n\n      document.body.addEventListener('touchstart', unlock, false);\n      document.body.addEventListener('touchend', unlock, false);\n    }\n  }\n\n  private async fetchAndDecodeAudio(url: string): Promise<AudioBuffer> {\n    try {\n      if (this.audioCache[url]) {\n        return this.audioCache[url];\n      }\n\n      const response = await fetch(url);\n      const buffer = await response.arrayBuffer();\n      const audioData = await this.audioContext!.decodeAudioData(buffer);\n\n      this.audioCache[url] = audioData;\n\n      return audioData;\n    } catch (error) {\n      if (this.debug) {\n        console.error('Audio loading and decoding error: ', error);\n      }\n\n      throw new Error(\n        `Something went wrong when loading and decoding the audio: ${(error as Error).message}`,\n      );\n    }\n  }\n\n  private async playAudio(url: string): Promise<void> {\n    this.initAudioContext();\n\n    try {\n      const audioData = await this.fetchAndDecodeAudio(url);\n      const source = this.audioContext!.createBufferSource();\n      const gainNode = this.audioContext!.createGain();\n\n      source.buffer = audioData;\n      gainNode.gain.value = this.volume;\n      source.connect(gainNode);\n      gainNode.connect(this.audioContext!.destination);\n\n      source.onended = (): void => {\n        if (this.callback) {\n          this.callback();\n        }\n      };\n\n      source.start(0);\n    } catch (error) {\n      if (this.debug) {\n        console.error('Audio playback error: ', error);\n      }\n\n      throw new Error(`Something went wrong while playing audio: ${(error as Error).message}`);\n    }\n  }\n\n  private throttleFn(func: () => Promise<void>): () => void {\n    return () => {\n      const now = Date.now();\n\n      if (now - this.lastClickTime >= this.throttle) {\n        void func().catch((error) => {\n          if (this.debug) {\n            console.error('Error in throttled function:', error);\n          }\n        });\n\n        this.lastClickTime = now;\n      }\n    };\n  }\n\n  public play(url: string = this.file): void {\n    const throttledPlay = this.throttleFn(() => this.playAudio(url));\n\n    try {\n      throttledPlay();\n    } catch (error) {\n      if (this.debug) {\n        console.error('Audio playback error: ', error);\n      }\n\n      if (this.callback) {\n        this.callback(error as Error);\n      } else {\n        throw error;\n      }\n    }\n  }\n}\n\nexport default ClickTone;\n"],"names":[],"version":3,"file":"index.module.js.map"}